# 性能测试指南

## 测试目标
- 验证系统延迟是否达到预期目标（端到端延迟≤30ms）
- 验证资源占用是否在合理范围内（GPU≤15%，CPU≤20%，内存≤200MB）
- 验证系统稳定性（连续运行24小时以上无崩溃）

## 测试环境
- 操作系统：Windows 10/11（64位专业版或企业版）
- GPU：NVIDIA RTX 4060
- CPU：Intel 12代i5/i3（H系列移动处理器）
- 内存：8GB RAM
- 网络：局域网环境，带宽≥20Mbps

## 测试工具
- **延迟测试**：使用高速相机拍摄屏幕内容变化到网络接收端显示的时间差
- **资源监控**：使用Windows任务管理器或Process Explorer监控CPU、GPU和内存占用
- **网络分析**：使用Wireshark捕获UDP数据包，分析网络延迟和丢包率

## 测试步骤

### 1. 系统准备
1. 确保安装最新的系统补丁和显卡驱动
2. 关闭所有不必要的后台程序
3. 启动被测试的直播推流软件

### 2. 延迟测试
1. 配置推流参数：分辨率640×640，帧率200FPS，码率15000kbps
2. 在发送端屏幕上显示一个秒表或时间戳
3. 在接收端屏幕上显示接收到的视频流
4. 使用高速相机同时拍摄发送端和接收端的屏幕
5. 分析视频，计算从发送端时间戳变化到接收端显示的时间差

### 3. 资源占用测试
1. 启动推流软件并运行30分钟
2. 使用任务管理器监控以下指标：
   - CPU使用率
   - GPU使用率
   - 内存占用
   - 网络带宽使用情况
3. 记录峰值和平均值

### 4. 稳定性测试
1. 配置推流软件以默认参数运行
2. 连续运行24小时以上
3. 定期检查软件状态，确保无崩溃或性能下降
4. 记录任何异常情况

## 测试结果分析

### 预期结果
- **延迟**：端到端延迟≤30ms
- **资源占用**：
  - GPU使用率：≤15%
  - CPU使用率：≤20%
  - 内存占用：≤200MB
- **稳定性**：连续运行24小时以上无崩溃

### 优化建议
1. **延迟优化**：
   - 调整NVENC编码参数，进一步降低编码延迟
   - 优化UDP传输策略，减少网络延迟
   - 减少线程间缓冲，保持数据实时性

2. **资源占用优化**：
   - 优化DXGI屏幕采集逻辑，减少GPU占用
   - 调整编码参数，平衡画质和资源占用
   - 优化内存管理，减少内存泄漏

3. **稳定性优化**：
   - 增加错误处理和异常捕获
   - 优化资源释放逻辑，避免资源泄漏
   - 增加系统监控和自动恢复机制

## 测试报告模板

### 测试环境
- 操作系统：
- GPU：
- CPU：
- 内存：
- 网络：

### 测试结果

#### 延迟测试
| 测试次数 | 端到端延迟（ms） | 编码延迟（ms） | 网络延迟（ms） |
|---------|----------------|---------------|---------------|
| 1       |                |               |               |
| 2       |                |               |               |
| 3       |                |               |               |
| 平均值  |                |               |               |

#### 资源占用测试
| 资源类型 | 平均值 | 峰值 |
|---------|-------|------|
| CPU使用率 |       |      |
| GPU使用率 |       |      |
| 内存占用 |       |      |
| 网络带宽 |       |      |

#### 稳定性测试
| 测试时间 | 状态 | 异常情况 |
|---------|------|----------|
| 0h      | 正常 |          |
| 6h      | 正常 |          |
| 12h     | 正常 |          |
| 18h     | 正常 |          |
| 24h     | 正常 |          |

### 结论
- 是否达到延迟目标：
- 是否达到资源占用目标：
- 是否达到稳定性目标：
- 建议改进：
